stages:
  - deploy

deploy_to_ec2:
  stage: deploy
  image: alpine:latest

  before_script:
    - apk add --no-cache openssh bash

  script:
    # Key abspeichern
    - echo "ðŸ”‘ Preparing SSH key"
    - chmod 600 "$EC2_KEY"

    # Code deployen + remote script ausfÃ¼hren
    - echo "ðŸš€ Deploying to EC2..."
    - ssh -o StrictHostKeyChecking=no -i "$EC2_KEY" $EC2_USER@$EC2_HOST "
        cd sem3-template || git clone https://gitlab.com/Cancani/sem3-template.git &&
        cd sem3-template &&
        git pull &&
        bash restart.sh
      "

  only:
    - main
